{% extends "base.html" %}

{% block title %}Reports{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="row">
    <div class="col-md-8 col-lg-6 mx-auto">
      <div class="card">
        <div class="card-header d-flex align-items-center justify-content-between">
          <strong>Generate Report</strong>
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('index') }}">Back to map</a>
        </div>
        <div class="card-body">
          <div class="alert alert-info" role="alert">
            Downloads are limited to 20 reports per IP address per day to ensure fair use.
          </div>
          <form id="reportForm">
            <div class="form-group">
              <label for="reportTypeModal">Report Type</label>
              <select class="form-control" id="reportTypeModal">
                <option value="top_matches">Top Matches by Distance</option>
                <option value="exact_matches">Top Exact Matches by Distance</option>
                <option value="name_matches">Top Name Matches by Distance</option>
                <option value="duplicates">Duplicates Report</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reportFormatModal">Report Format</label>
              <select class="form-control" id="reportFormatModal">
                <option value="pdf">PDF</option>
                <option value="csv">CSV</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reportLimitModal">Number of Entries (N):</label>
              <input type="number" id="reportLimitModal" class="form-control" value="10" min="1" max="500" required>
            </div>
            <div class="form-group">
              <label for="sortOrderModal">Sort Order:</label>
              <select id="sortOrderModal" class="form-control">
                <option value="distance_desc">Distance (Descending)</option>
                <option value="distance_asc">Distance (Ascending)</option>
                <option value="id_asc">Stop ID (Ascending)</option>
              </select>
            </div>
            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-primary">Generate</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/pages/report.js') }}"></script>
<script>
  if (window.initReportGeneration) { window.initReportGeneration(); }
  // Optional: allow direct link with query to auto-generate
  (function(){
    var params = new URLSearchParams(window.location.search);
    if (params.has('auto')) {
      // Pre-fill if provided
      if (params.get('report_type')) document.getElementById('reportTypeModal').value = params.get('report_type');
      if (params.get('format')) document.getElementById('reportFormatModal').value = params.get('format');
      if (params.get('limit')) document.getElementById('reportLimitModal').value = params.get('limit');
      if (params.get('sort')) document.getElementById('sortOrderModal').value = params.get('sort');
      document.getElementById('reportForm').dispatchEvent(new Event('submit'));
    }
  })();
</script>
{% endblock %}


