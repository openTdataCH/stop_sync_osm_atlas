{% extends "base.html" %}

{% from "components/_components.html" import header_chip with context %}
{% block title %}Persistent Data Management{% endblock %}

{% block head_css %}
  <!-- Persistent Data specific CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/persistent-data.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  
  
  <div class="row mb-4">
    <div class="col-md-6">
      <a href="{{ url_for('problems') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Problems
      </a>
      <a href="{{ url_for('index') }}" class="btn btn-outline-primary ml-2">
        <i class="fas fa-map"></i> Map page
      </a>
    </div>
    <div class="col-md-6 text-right">
      <div class="btn-group">
        <button id="makeAllPersistentBtn" class="btn btn-outline-success" title="Make all current problem solutions persistent">
          <i class="fas fa-save"></i> Make All Persistent
        </button>
        <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-filter"></i> Filter by Type
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item filter-type-btn" href="#" data-type="all">All Types</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item filter-type-btn" href="#" data-type="distance">Distance Problems</a>
          <a class="dropdown-item filter-type-btn" href="#" data-type="unmatched">Unmatched Problems</a>
          <a class="dropdown-item filter-type-btn" href="#" data-type="attributes">Attributes Problems</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item filter-type-btn" href="#" data-type="atlas_note">ATLAS Notes</a>
          <a class="dropdown-item filter-type-btn" href="#" data-type="osm_note">OSM Notes</a>
        </div>
      </div>
    </div>
  </div>
  
  <div class="alert alert-info">
    <i class="fas fa-info-circle"></i> Persistent data is automatically applied after each data import. 
    They help maintain permanent problem resolutions after data imports.
  </div>
  
  <!-- Tab Navigation -->
  <ul class="nav nav-tabs" id="dataTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="persistent-tab" data-toggle="tab" href="#persistent" role="tab" aria-controls="persistent" aria-selected="true">
        <i class="fas fa-database"></i> Persistent Data
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="non-persistent-tab" data-toggle="tab" href="#non-persistent" role="tab" aria-controls="non-persistent" aria-selected="false">
        <i class="fas fa-clock"></i> Non-Persistent Data
      </a>
    </li>
  </ul>
  
  <!-- Tab Content -->
  <div class="tab-content" id="dataTabContent">
    <div class="tab-pane fade show active" id="persistent" role="tabpanel" aria-labelledby="persistent-tab">
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="alert alert-info mb-0 flex-grow-1">
            <i class="fas fa-info-circle"></i> This data is permanently stored and will be automatically applied after future data imports.
          </div>
          <div id="clear-all-persistent-container" class="text-right ml-3"></div>
        </div>
        
        <div id="persistent-data-container">
          <!-- Data will be loaded here dynamically -->
          <div class="text-center py-5">
            <div class="spinner-border" role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">Loading persistent data...</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-pane fade" id="non-persistent" role="tabpanel" aria-labelledby="non-persistent-tab">
      <div class="mt-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="alert alert-warning mb-0 flex-grow-1">
            <i class="fas fa-exclamation-triangle"></i> This data is temporary and will be lost on the next data import unless made persistent.
          </div>
          <div id="clear-all-non-persistent-container" class="text-right ml-3"></div>
        </div>
        
        <div id="non-persistent-data-container">
          <!-- Data will be loaded here dynamically -->
        </div>
      </div>
    </div>
  </div>
  
  <div class="pagination-container">
    <nav aria-label="Data pagination">
      <ul class="pagination" id="dataPagination">
        <!-- Pagination will be generated dynamically -->
      </ul>
    </nav>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this persistent solution? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Clear Confirmation Modal -->
<div class="modal fade" id="clearConfirmModal" tabindex="-1" role="dialog" aria-labelledby="clearConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="clearConfirmModalLabel">Confirm Clear</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to clear this non-persistent solution/note? This will remove the solution/note but not the underlying problem or stop.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning" id="confirmClearBtn">Clear Data</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Persistent Data Management JavaScript -->
  <script src="{{ url_for('static', filename='js/pages/persistent-data.js') }}"></script>
{% endblock %}


